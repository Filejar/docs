{
  "openapi": "3.0.0",
  "info": {
    "title": "FileJar Core API",
    "version": "1.0.0",
    "description": "API documentation for FileJar Core API - File upload and organization management"
  },
  "servers": [
    {
      "url": "http://localhost:8787",
      "description": "Local development server"
    },
    {
      "url": "https://core-api.filejar-dev.workers.dev",
      "description": "Production server"
    }
  ],
  "tags": [
    {
      "name": "Health",
      "description": "Health check endpoints"
    },
    {
      "name": "Upload",
      "description": "File upload endpoints"
    }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": ["Health"],
        "summary": "Root endpoint",
        "description": "Returns API information",
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "filejar-core-api"
                    },
                    "version": {
                      "type": "string",
                      "example": "1.0.0"
                    },
                    "docs": {
                      "type": "string",
                      "example": "/api-docs"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health check",
        "description": "Returns the health status of the API",
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "time": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "version": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/upload/prepare": {
      "post": {
        "tags": ["Upload"],
        "summary": "Prepare file upload(s)",
        "description": "Creates presigned URLs for one or more file uploads to Filejar storage. Processes multiple files in parallel. Requires API key authentication.",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "description": "Array of files to prepare for upload",
                "items": {
                  "type": "object",
                  "properties": {
                    "file_name": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 255,
                      "description": "Optional file name. If not provided, a random UUID will be used.",
                      "example": "my-file.pdf"
                    }
                  }
                },
                "example": [
                  {
                    "file_name": "document1.pdf"
                  },
                  {
                    "file_name": "image1.jpg"
                  },
                  {}
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Upload preparation successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "description": "Array of prepared uploads",
                  "items": {
                    "type": "object",
                    "properties": {
                      "key": {
                        "type": "string",
                        "description": "File key/path in storage",
                        "example": "org-id/filename.pdf"
                      },
                      "signed_url": {
                        "type": "string",
                        "format": "uri",
                        "description": "Proxy URL for uploading files through the API (PUT request to /v1/files/{key})",
                        "example": "https://core-api.filejar-dev.workers.dev/v1/files/org-id/filename.pdf"
                      },
                      "upload_id": {
                        "type": "string",
                        "format": "uuid",
                        "description": "Unique identifier for this upload"
                      }
                    },
                    "required": ["key", "signed_url", "upload_id"]
                  },
                  "example": [
                    {
                      "key": "org-id/document1.pdf",
                      "signed_url": "https://core-api.filejar-dev.workers.dev/v1/files/org-id/document1.pdf",
                      "upload_id": "123e4567-e89b-12d3-a456-426614174000"
                    },
                    {
                      "key": "org-id/image1.jpg",
                      "signed_url": "https://core-api.filejar-dev.workers.dev/v1/files/org-id/image1.jpg",
                      "upload_id": "223e4567-e89b-12d3-a456-426614174001"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Validation failed"
                    },
                    "fields": {
                      "type": "object",
                      "description": "Field-specific validation errors"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing API key",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "API key required"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Organization not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Organization not found"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "description": "Too many requests - Rate limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Too many requests, please try again later"
                    },
                    "retryAfter": {
                      "type": "number",
                      "description": "Seconds to wait before retrying"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Internal server error"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/upload/ack": {
      "post": {
        "tags": ["Upload"],
        "summary": "Acknowledge file upload(s)",
        "description": "Acknowledges that one or more file uploads have been completed. This endpoint verifies files exist in storage and updates upload records with metadata. Processes multiple uploads in parallel. Each result in the response array may be a success or error object.",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "description": "Array of upload IDs to acknowledge",
                "items": {
                  "type": "object",
                  "properties": {
                    "upload_id": {
                      "type": "string",
                      "format": "uuid",
                      "description": "The upload ID returned from /prepare endpoint",
                      "example": "123e4567-e89b-12d3-a456-426614174000"
                    }
                  },
                  "required": ["upload_id"]
                },
                "example": [
                  {
                    "upload_id": "123e4567-e89b-12d3-a456-426614174000"
                  },
                  {
                    "upload_id": "223e4567-e89b-12d3-a456-426614174001"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Upload acknowledgment results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "description": "Array of acknowledgment results. Each item may be a success object or an error object.",
                  "items": {
                    "oneOf": [
                      {
                        "type": "object",
                        "description": "Successful acknowledgment",
                        "properties": {
                          "upload_id": {
                            "type": "string",
                            "format": "uuid",
                            "description": "The upload ID that was acknowledged"
                          },
                          "acknowledged_at": {
                            "type": "string",
                            "format": "date-time",
                            "description": "Timestamp when the upload was acknowledged"
                          },
                          "size": {
                            "type": "integer",
                            "description": "File size in bytes",
                            "example": 1024
                          },
                          "content_type": {
                            "type": "string",
                            "description": "MIME type of the uploaded file",
                            "example": "application/pdf"
                          }
                        },
                        "required": [
                          "upload_id",
                          "acknowledged_at",
                          "size",
                          "content_type"
                        ]
                      },
                      {
                        "type": "object",
                        "description": "Error for a specific upload",
                        "properties": {
                          "upload_id": {
                            "type": "string",
                            "format": "uuid",
                            "description": "The upload ID that failed"
                          },
                          "error": {
                            "type": "string",
                            "description": "Error message (e.g., 'Upload not found' or 'Upload is not completed yet')",
                            "example": "Upload not found"
                          }
                        },
                        "required": ["upload_id", "error"]
                      }
                    ]
                  },
                  "example": [
                    {
                      "upload_id": "123e4567-e89b-12d3-a456-426614174000",
                      "acknowledged_at": "2024-01-01T12:00:00Z",
                      "size": 1024,
                      "content_type": "application/pdf"
                    },
                    {
                      "upload_id": "223e4567-e89b-12d3-a456-426614174001",
                      "error": "Upload is not completed yet"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Validation failed"
                    },
                    "fields": {
                      "type": "object",
                      "description": "Field-specific validation errors"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing API key",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "API key required"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Upload not found or not completed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Upload not found",
                      "description": "Either 'Upload not found' or 'Upload is not completed yet'"
                    }
                  }
                }
              }
            }
          },
          "429": {
            "description": "Too many requests - Rate limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Too many requests, please try again later"
                    },
                    "retryAfter": {
                      "type": "number",
                      "description": "Seconds to wait before retrying"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Internal server error"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "x-api-key",
        "description": "WorkOS API key for authentication"
      }
    }
  }
}
